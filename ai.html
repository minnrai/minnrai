<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome (for icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <!-- Google Fonts (Poppins) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --theme-primary: #3b82f6; /* Default blue */
            --theme-secondary: #ec4899; /* Default pink */
        }
        body {
            font-family: 'Poppins', sans-serif;
        }
        /* Custom styles for Tabs */
        .tabs-trigger[data-state='active'] {
            background-color: white;
            color: #1f2937; /* gray-800 */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        /* Simple CSS Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }

        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        .animate-slideInUp { animation: slideInUp 0.5s ease-out forwards; }
        .animate-scaleIn { animation: scaleIn 0.5s ease-out forwards; }
        .animate-dot-bounce { animation: bounce 1.4s infinite ease-in-out both; }
        
        /* Toast Notification */
        #toast-notification {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            transform: translateY(100%);
            opacity: 0;
        }
        #toast-notification.show {
            transform: translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="min-h-screen flex items-center justify-center">
        <div class="w-16 h-16 border-4 border-dashed rounded-full animate-spin border-blue-500"></div>
    </div>

    <!-- Error Message -->
    <div id="error-container" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-red-100 hidden">
        <div class="bg-white p-6 rounded-2xl shadow-lg w-full max-w-md mx-4 text-center">
            <h2 class="text-xl font-semibold mb-2">Error Loading Page</h2>
            <p id="error-message" class="text-gray-600">Could not fetch data.</p>
        </div>
    </div>

    <!-- Main Content (initially hidden) -->
    <div id="main-content" class="hidden">
        <div class="min-h-screen bg-gradient-to-br from-theme-secondary via-white to-theme-primary">
            <!-- Navigation -->
            <nav class="sticky top-0 bg-white/70 backdrop-blur-lg z-40 shadow-sm">
                <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                    <h1 id="nav-title" class="text-xl font-bold text-gray-800">WebApp</h1>
                    <a href="#" class="bg-gray-800 text-white px-4 py-2 rounded-full text-sm hover:bg-gray-900 transition">Get Started</a>
                </div>
            </nav>

            <main class="container mx-auto px-4 py-8">
                <!-- Header -->
                <div class="flex items-center justify-between mb-8 animate-slideInUp">
                    <div class="flex items-center space-x-4">
                        <a href="index.html" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3">
                            <i class="fas fa-arrow-left w-4 h-4 mr-2"></i>
                            Back to Home
                        </a>
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-robot w-8 h-8 text-blue-500"></i>
                            <h1 class="text-3xl font-poppins font-bold text-gray-800">AI Assistant</h1>
                        </div>
                    </div>
                    <div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80 space-x-1">
                        <i class="fas fa-eye w-4 h-4"></i>
                        <span id="visitor-count">0 visitors</span>
                    </div>
                </div>

                <div class="max-w-4xl mx-auto animate-fadeIn" style="animation-delay: 0.2s;">
                    <!-- Tabs -->
                    <div class="space-y-6">
                        <div id="tabs-list" class="grid w-full grid-cols-3 p-1 h-10 items-center justify-center rounded-lg bg-muted text-muted-foreground bg-gray-200">
                            <button data-value="chat" class="tabs-trigger inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium" data-state="active">AI Chat</button>
                            <button data-value="translate" class="tabs-trigger inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium" data-state="inactive">Translator</button>
                            <button data-value="tools" class="tabs-trigger inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium" data-state="inactive">AI Tools</button>
                        </div>

                        <!-- AI Chat Content -->
                        <div id="tab-content-chat" class="tab-content">
                             <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                                <div class="p-6 flex items-center space-x-2">
                                    <i class="fas fa-robot w-5 h-5"></i>
                                    <h3 class="text-lg font-semibold">AI Chat Assistant</h3>
                                </div>
                                <div class="p-6 pt-0 space-y-4">
                                    <div id="chat-history" class="border rounded-lg p-4 h-96 overflow-y-auto bg-gray-50 flex flex-col space-y-4">
                                        <!-- Messages will be injected here -->
                                    </div>
                                    <div class="flex space-x-2">
                                        <input id="chat-input" type="text" placeholder="Ask me anything..." class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 flex-1">
                                        <button id="chat-send-btn" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium h-10 w-10 bg-[var(--theme-primary)] text-white hover:bg-[var(--theme-primary)]/90 disabled:opacity-50">
                                            <i class="fas fa-paper-plane w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Translator Content -->
                        <div id="tab-content-translate" class="tab-content hidden">
                            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                                <div class="p-6"><h3 class="text-lg font-semibold">AI Translator</h3></div>
                                <div class="p-6 pt-0 space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Input Text</label>
                                            <textarea id="translate-input" placeholder="Enter text to translate..." class="flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm h-32"></textarea>
                                        </div>
                                        <div>
                                            <div class="flex items-center justify-between mb-2">
                                                <label class="block text-sm font-medium">Translation</label>
                                                <button id="copy-btn" class="hidden inline-flex items-center justify-center text-sm h-8 px-2 rounded-md border hover:bg-accent">
                                                    <i class="fas fa-copy w-3 h-3 mr-1"></i> Copy
                                                </button>
                                            </div>
                                            <textarea id="translate-output" readonly class="flex min-h-[80px] w-full rounded-md border bg-gray-50 px-3 py-2 text-sm h-32" placeholder="Translation will appear here..."></textarea>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Target Language</label>
                                            <select id="language-select" class="h-10 w-48 rounded-md border border-input bg-transparent px-3 py-2 text-sm">
                                                <!-- Languages will be injected here -->
                                            </select>
                                        </div>
                                        <div class="flex-1">
                                            <button id="translate-btn" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium h-10 px-4 mt-6 bg-[var(--theme-primary)] text-white hover:bg-[var(--theme-primary)]/90 disabled:opacity-50">
                                                Translate
                                            </button>
                                        </div>
                                    </div>
                                    <div id="translator-error" class="hidden items-center rounded-lg border border-red-300 bg-red-50 text-red-700 p-3 text-sm">
                                        <i class="fas fa-exclamation-circle h-4 w-4 mr-2"></i>
                                        <span id="translator-error-msg"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Tools Content -->
                        <div id="tab-content-tools" class="tab-content hidden">
                            <div id="tools-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- AI Tool cards will be injected here -->
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="bg-gray-800 text-white py-6 mt-12">
                <div class="container mx-auto text-center">
                    <p>&copy; 2024 <span id="footer-title">WebApp</span>. All Rights Reserved.</p>
                </div>
            </footer>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast-notification" class="fixed bottom-5 right-5 bg-gray-900 text-white px-4 py-2 rounded-lg shadow-lg">
        <span id="toast-message"></span>
    </div>

    <script type="module">
        import './firebase-init.js';

        // --- STATE & CONFIG ---
        let chatHistory = [];
        let isLoading = false;
        const LANGUAGES = [
            { value: 'en', label: 'English' }, { value: 'es', label: 'Spanish' }, { value: 'fr', label: 'French' },
            { value: 'de', label: 'German' }, { value: 'it', label: 'Italian' }, { value: 'pt', label: 'Portuguese' },
            { value: 'ja', label: 'Japanese' }, { value: 'ko', label: 'Korean' }, { value: 'zh', label: 'Chinese' }
        ];
        const AI_TOOLS = [
            { title: 'Text Summarizer', description: 'Summarize long texts into key points', icon: '📝', comingSoon: true },
            { title: 'Content Generator', description: 'Generate creative content and ideas', icon: '✨', comingSoon: true },
            { title: 'Grammar Checker', description: 'Check and improve your grammar', icon: '✅', comingSoon: true },
            { title: 'Code Helper', description: 'Get help with programming tasks', icon: '💻', comingSoon: true },
            { title: 'Email Writer', description: 'Generate professional emails', icon: '📧', comingSoon: true },
            { title: 'Question Answerer', description: 'Get answers to any question', icon: '❓', comingSoon: false }
        ];

        // --- DOM ELEMENTS ---
        const loadingSpinner = document.getElementById('loading-spinner');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');
        const mainContent = document.getElementById('main-content');
        const visitorCount = document.getElementById('visitor-count');
        
        // Chat
        const chatHistoryEl = document.getElementById('chat-history');
        const chatInput = document.getElementById('chat-input');
        const chatSendBtn = document.getElementById('chat-send-btn');

        // Translator
        const translateInput = document.getElementById('translate-input');
        const translateOutput = document.getElementById('translate-output');
        const languageSelect = document.getElementById('language-select');
        const translateBtn = document.getElementById('translate-btn');
        const copyBtn = document.getElementById('copy-btn');
        const translatorError = document.getElementById('translator-error');
        const translatorErrorMsg = document.getElementById('translator-error-msg');

        // Tabs
        const tabsList = document.getElementById('tabs-list');
        const tabContents = document.querySelectorAll('.tab-content');

        // Toast
        const toastEl = document.getElementById('toast-notification');
        const toastMsg = document.getElementById('toast-message');

        // --- RENDER FUNCTIONS ---
        function updateTheme(root, color, gradation) {
            if (color) root.style.setProperty('--theme-primary', color);
            if (gradation) root.style.setProperty('--theme-secondary', gradation);
        }

        function renderStaticContent(data) {
            const websetting = data.websetting;
            if (websetting) {
                updateTheme(document.documentElement, websetting.color, websetting.gradation);
                document.title = `${websetting.name} - AI Assistant`;
                document.getElementById('nav-title').textContent = websetting.name;
                document.getElementById('footer-title').textContent = websetting.name;
            }
            visitorCount.textContent = `${(data.ai?.visitor || 0).toLocaleString()} visitors`;
        }

        function renderChatHistory() {
            chatHistoryEl.innerHTML = ''; // Clear
            if (chatHistory.length === 0) {
                chatHistoryEl.innerHTML = `
                    <div class="text-center text-gray-500 my-auto">
                        <i class="fas fa-robot w-16 h-16 mx-auto mb-4 text-gray-300 text-6xl"></i>
                        <p>Start a conversation with AI Assistant</p>
                    </div>`;
                return;
            }
            chatHistory.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`;
                messageDiv.innerHTML = `
                    <div class="max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${msg.type === 'user' ? 'bg-[var(--theme-primary)] text-white' : 'bg-white border'}">
                        <p class="text-sm break-words">${msg.content}</p>
                    </div>`;
                chatHistoryEl.appendChild(messageDiv);
            });

            if (isLoading) {
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'flex justify-start';
                loadingDiv.innerHTML = `
                    <div class="bg-white border px-4 py-2 rounded-lg">
                        <div class="flex space-x-1.5">
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-dot-bounce"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-dot-bounce" style="animation-delay: 0.1s;"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-dot-bounce" style="animation-delay: 0.2s;"></div>
                        </div>
                    </div>`;
                chatHistoryEl.appendChild(loadingDiv);
            }
            chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;
        }

        function renderLanguages() {
            LANGUAGES.forEach(lang => {
                const option = document.createElement('option');
                option.value = lang.value;
                option.textContent = lang.label;
                languageSelect.appendChild(option);
            });
        }

        function renderTools() {
            const grid = document.getElementById('tools-grid');
            AI_TOOLS.forEach((tool, index) => {
                const card = document.createElement('div');
                card.className = "animate-scaleIn";
                card.style.animationDelay = `${index * 0.1}s`;
                card.innerHTML = `
                    <div class="rounded-lg border bg-card text-card-foreground shadow-sm h-full ${tool.comingSoon ? 'opacity-60' : 'hover:shadow-lg transition-shadow cursor-pointer'}">
                        <div class="p-6 text-center flex flex-col h-full">
                            <div class="text-4xl mb-4">${tool.icon}</div>
                            <h3 class="font-semibold text-lg mb-2">${tool.title}</h3>
                            <p class="text-sm text-gray-600 mb-4 flex-grow">${tool.description}</p>
                            ${tool.comingSoon ? 
                                `<div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold">Coming Soon</div>` :
                                `<button class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium h-9 px-3 bg-[var(--theme-primary)] text-white hover:bg-[var(--theme-primary)]/90">Try Now</button>`
                            }
                        </div>
                    </div>`;
                grid.appendChild(card);
            });
        }
        
        function showToast(message) {
            toastMsg.textContent = message;
            toastEl.classList.add('show');
            setTimeout(() => {
                toastEl.classList.remove('show');
            }, 3000);
        }

        // --- EVENT HANDLERS ---
        async function handleSendMessage() {
            const messageText = chatInput.value.trim();
            if (!messageText || isLoading) return;

            chatHistory.push({ type: 'user', content: messageText });
            chatInput.value = '';
            isLoading = true;
            renderChatHistory();

            // Simulate AI response
            setTimeout(() => {
                const aiResponse = {
                    type: 'ai',
                    content: `I understand you're asking about "${messageText}". As an AI assistant, I can help you with various tasks including content creation, answering questions, translation, and much more. How can I specifically assist you today?`
                };
                chatHistory.push(aiResponse);
                isLoading = false;
                renderChatHistory();
            }, 1500);
        }
        
        async function handleTranslate() {
            const text = translateInput.value.trim();
            if (!text) {
                translatorErrorMsg.textContent = 'Please enter text to translate';
                translatorError.classList.remove('hidden');
                translatorError.classList.add('flex');
                return;
            }

            isLoading = true;
            translatorError.classList.add('hidden');
            translateBtn.disabled = true;
            translateBtn.textContent = 'Translating...';

            // Simulate translation
            setTimeout(() => {
                const translations = {
                    en: 'This is a sample English translation of your text.', es: 'Esta es una traducción al español de muestra de su texto.',
                    fr: 'Ceci est un exemple de traduction française de votre texte.', de: 'Dies ist eine deutsche Beispielübersetzung Ihres Textes.',
                    it: 'Questa è una traduzione italiana di esempio del tuo testo.', pt: 'Esta é uma tradução em português de exemplo do seu texto.',
                    ja: 'これはあなたのテキストの日本語の翻訳例です。', ko: '이것은 귀하의 텍스트에 대한 한국어 번역 예시입니다.', zh: '这是您文本的中文翻译示例。'
                };
                const selectedLang = languageSelect.value;
                translateOutput.value = translations[selectedLang] || translations.en;
                copyBtn.classList.remove('hidden');
                
                isLoading = false;
                translateBtn.disabled = false;
                translateBtn.textContent = 'Translate';
            }, 1000);
        }

        function handleTabClick(event) {
            const clickedTab = event.target.closest('.tabs-trigger');
            if (!clickedTab) return;

            const targetValue = clickedTab.dataset.value;

            // Update tab buttons state
            tabsList.querySelectorAll('.tabs-trigger').forEach(tab => {
                tab.dataset.state = tab === clickedTab ? 'active' : 'inactive';
            });

            // Update tab content visibility
            tabContents.forEach(content => {
                if (content.id === `tab-content-${targetValue}`) {
                    content.classList.remove('hidden');
                } else {
                    content.classList.add('hidden');
                }
            });
        }
        
        function handleCopy() {
            const text = translateOutput.value;
            if (!text) return;
            navigator.clipboard.writeText(text).then(() => {
                showToast('Text copied to clipboard!');
            }).catch(err => {
                showToast('Failed to copy text.');
                console.error('Copy failed', err);
            });
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const data = await window.firebaseMINNRAI.getWebData();
                if (!data) throw new Error("No data received from Firebase.");

                renderStaticContent(data);
                renderChatHistory();
                renderLanguages();
                renderTools();

                // Attach Event Listeners
                chatSendBtn.addEventListener('click', handleSendMessage);
                chatInput.addEventListener('keypress', (e) => e.key === 'Enter' && handleSendMessage());
                translateBtn.addEventListener('click', handleTranslate);
                copyBtn.addEventListener('click', handleCopy);
                tabsList.addEventListener('click', handleTabClick);

                loadingSpinner.style.display = 'none';
                mainContent.style.display = 'block';

            } catch (err) {
                console.error("Initialization failed:", err);
                loadingSpinner.style.display = 'none';
                errorMessage.textContent = err.message;
                errorContainer.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>